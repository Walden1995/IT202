<!DOCTYPE html>
<html class="mdc-typography">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Greeting App</title>
  <link rel="stylesheet" href="https://unpkg.com/material-components-web@latest/dist/material-components-web.min.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
  <style>
    :root {
      --mdc-theme-primary: #616161;
      --mdc-theme-primary-light: #8e8e8e;
      --mdc-theme-primary-dark: #373737;
      --mdc-theme-secondary: #7b1fa2;
      --mdc-theme-secondary-light: #ae52d4;
      --mdc-theme-secondary-dark: #4a0072;
      --mdc-theme-text-<TEXT_STYLE>-on-<THEME_COLOR>: ;
      --mdc-theme-text-<TEXT_STYLE>-on-light: ;
      --mdc-theme-text-<TEXT_STYLE>-on-dark: ;
    }

    .sample {
      display: none;
    }

    #meter {
      border-top: -50px;
      width: 194px;
      height: 150px;
      text-align: center;
      border: 3px;
      border-style: solid;
      border-color: #616161;
    }
  </style>
</head>

<body>
  <header class="mdc-toolbar mdc-elevation--z4">
    <div class="mdc-toolbar__row">
      <section class="mdc-toolbar__section mdc-toolbar__section--align-start">
        <button class="demo-menu material-icons mdc-toolbar__menu-icon">menu</button>
        <span class="mdc-toolbar__title catalog-title">Sensor Toolkit</span>
      </section>
    </div>
  </header>

  <aside class="mdc-temporary-drawer mdc-typography">
    <nav class="mdc-temporary-drawer__drawer">
      <header class="mdc-temporary-drawer__header">
        <div class="mdc-temporary-drawer__header-content mdc-theme--primary-bg mdc-theme--text-primary-on-primary">
          Header here
        </div>
      </header>
      <nav class="mdc-temporary-drawer__content mdc-list-group">
        <div id="icon-with-text-demo" class="mdc-list">
          <a class="mdc-list-item mdc-temporary-drawer--selected" href="#" data-mdc-tabindex-handled="true" tabindex="-1" onclick="openTab(event, 'page1')">
              <i class="material-icons">hearing</i><i class="material-icons">network_cell</i>Audio-Electro-Magnetic
            </a>
          <a class="mdc-list-item" href="#" data-mdc-tabindex-handled="true" tabindex="-1" onclick="openTab(event, 'page2')">
              <i class="material-icons">location_on</i><i class="material-icons">track_changes</i>Accelerometer-Geolocation
            </a>
          <a class="mdc-list-item" href="#" data-mdc-tabindex-handled="true" tabindex="-1" onclick="openTab(event, 'page3')">
              <i class="material-icons">wb_sunny</i><i class="material-icons">wb_cloudy</i>Weather Info
            </a>
        </div>
      </nav>
    </nav>
  </aside>


  <main id="page1">
    <div class="mdc-grid-list">
      <ul class="mdc-grid-list__tiles">
        <li class="mdc-grid-tile">
          <div id="meterholder" class="mdc-grid-tile__primary">
            <h2 class="mdc-typography--display1" id="audioinformation"></h2>
            <canvas id="meter" width="150" height="150"></canvas>

          </div>
          <span class="mdc-grid-tile__secondary">
        <span class="mdc-grid-tile__title">Title</span>
          </span>
        </li>
        <li class="mdc-grid-tile">
          <div class="mdc-grid-tile__primary">
            <p>network type is <b id="networkType">not available</b>.</p>
            <p>actual type is <b id="effectiveNetworkType">not available</b>.</p>
            <p>downlink speed <b id="downlinkMax">not available</b>.</p>
          </div>
          <span class="mdc-grid-tile__secondary">
        <span class="mdc-grid-tile__title">Title</span>
          </span>
        </li>
      </ul>
    </div>
    <h1 class="mdc-typography--display1">Audio / Radio information</h1>
    <!-- The canvas that will be used to render the input level -->

  </main>

  <main id="page2" class="sample">
    <h1 class="mdc-typography--display1">Geological information</h1>
  </main>

  <main id="page3" class="sample">
    <h1 class="mdc-typography--display1">Weather information</h1>
  </main>


  <script src="https://unpkg.com/material-components-web@latest/dist/material-components-web.min.js"></script>
  <script src="../jquery.min.js"></script>
  <script>
    window.mdc.autoInit();

    var drawerEl = document.querySelector('.mdc-temporary-drawer');
    var MDCTemporaryDrawer = mdc.drawer.MDCTemporaryDrawer;
    var drawer = new MDCTemporaryDrawer(drawerEl);
    document.querySelector('.demo-menu').addEventListener('click', function() {
      drawer.open = !drawer.open;
    });
    drawerEl.addEventListener('MDCPersistentDrawer:open', function() {
      console.log('Received MDCPersistentDrawer:open');
    });
    drawerEl.addEventListener('MDCPersistentDrawer:close', function() {
      console.log('Received MDCPersistentDrawer:close');
    });
  </script>

  <script>
    $(document).ready(function() {
      $("main").hide();
      $("#page1").show();
      var info = getConnection();
      if (info) {
        info.addEventListener('change', updateNetworkInfo);
        updateNetworkInfo(info);
      }
    });

    function openTab(evt, tabName) {
      $("main").hide();
      $('#' + tabName).show();
      drawer.open = !drawer.open;
    }

    function getConnection() {
      return navigator.connection || navigator.mozConnection ||
        navigator.webkitConnection || navigator.msConnection;
    }

    function updateNetworkInfo(info) {
      document.getElementById('networkType').innerHTML = info.type;
      document.getElementById('effectiveNetworkType').innerHTML = info.effectiveType;
      document.getElementById('downlinkMax').innerHTML = info.downlinkMax;
    }
  </script>

  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker
        .register('./service-worker.js')
        .then(function() { console.log("Service Worker Registered"); });
    }
  </script>

  <script>
    navigator.getUserMedia = navigator.getUserMedia ||
      navigator.webkitGetUserMedia ||
      navigator.mozGetUserMedia;
    if (navigator.getUserMedia) {
      navigator.getUserMedia({
          audio: true
        },
        function(stream) {
          audioContext = new AudioContext();
          analyser = audioContext.createAnalyser();
          microphone = audioContext.createMediaStreamSource(stream);
          javascriptNode = audioContext.createScriptProcessor(2048, 1, 1);

          analyser.smoothingTimeConstant = 0.8;
          analyser.fftSize = 1024;

          microphone.connect(analyser);
          analyser.connect(javascriptNode);
          javascriptNode.connect(audioContext.destination);

          canvasContext = $("#meter")[0].getContext("2d");

          javascriptNode.onaudioprocess = function() {
            var array = new Uint8Array(analyser.frequencyBinCount);
            analyser.getByteFrequencyData(array);
            var values = 0;

            var length = array.length;
            for (var i = 0; i < length; i++) {
              values += (array[i]);
            }

            var average = values / length;

            //console.log(Math.round(average + 40));

            canvasContext.clearRect(0, 0, 150, 150);
            canvasContext.fillStyle = '#BadA55';
            canvasContext.fillRect(0, 150 - average, 150, 150);
            canvasContext.fillStyle = '#262626';
            canvasContext.font = "48px impact";
            canvasContext.fillText(average.toFixed(2), -2, 150);

          } // end fn stream
        },
        function(err) {
          console.log("The following error occured: " + err.name)
        });
    }
    else {
      console.log("getUserMedia not supported");
    }
  </script>
</body>

</html>
